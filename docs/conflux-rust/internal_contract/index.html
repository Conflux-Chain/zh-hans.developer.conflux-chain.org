<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">内置合约 | Conflux</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="内置合约 | Conflux"><meta data-react-helmet="true" name="description" content="Conflux 引入了一些内置的内部合约，以便更好地进行系统维护和链上治理。而本文档将介绍如何使用这些内部合约。"><meta data-react-helmet="true" property="og:description" content="Conflux 引入了一些内置的内部合约，以便更好地进行系统维护和链上治理。而本文档将介绍如何使用这些内部合约。"><meta data-react-helmet="true" name="keywords" content="conflux,contract"><meta data-react-helmet="true" property="og:url" content="https://zh-hans.developer.conflux-chain.org/docs/conflux-rust/internal_contract"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://zh-hans.developer.conflux-chain.org/docs/conflux-rust/internal_contract"><link rel="stylesheet" href="/styles.0807ff50.css">
<link rel="preload" href="/styles.90a36a4b.js" as="script">
<link rel="preload" href="/runtime~main.44580b67.js" as="script">
<link rel="preload" href="/main.80992f61.js" as="script">
<link rel="preload" href="/1.a6d3011e.js" as="script">
<link rel="preload" href="/2.f4b29584.js" as="script">
<link rel="preload" href="/19.d2aa76d9.js" as="script">
<link rel="preload" href="/25.ab966ef1.js" as="script">
<link rel="preload" href="/20ac7829.8e977c11.js" as="script">
<link rel="preload" href="/17896441.b7243d10.js" as="script">
<link rel="preload" href="/22.472e83af.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Conflux-Chain/zh-hans.developer.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_tL-o"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1Uz6 moon_1dCK"></span></div><div class="react-toggle-track-x"><span class="toggle_1Uz6 sun_2xxQ"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/Conflux-Chain/zh-hans.developer.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3g4J"><div class="docSidebarContainer_1kHB" role="complementary"><div class="sidebar_1X4e"><div class="menu menu--responsive menu_3NRO"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_3lA8" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_3UG6">了解 Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/conflux_overview">概述</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_3UG6">使用 Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/installation">安装</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/get_started">入门 Conflux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/send_transaction">发送第一笔交易</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/independent_chain">如何设置独立的conflux区块链</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/conflux-rust/internal_contract">内置合约</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_3UG6">SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/json_rpc">JSON RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/cli_sub_commands">使用 Conflux 命令行工具</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/js-conflux-sdk/javascript_sdk">Javascript SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/go-conflux-sdk/go_sdk">Golang SDK</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_3UG6">ConfluxPortal</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/introduction">什么是 ConfluxPortal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/Main_Concepts/getting_started">入门 ConfluxPortal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/Main_Concepts/accessing_accounts">获得账户信息</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/Main_Concepts/sending_transactions">发送交易</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/API_Reference/provider_api">Portal 的 Provider API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/API_Reference/signing_data_with_portal">使用 ConfluxPortal 浏览器插件钱包对数据签名</a></li></ul></li></ul></div></div></div><main class="docMainContainer_34ah"><div class="container padding-vert--lg docItemWrapper_1FLB"><div class="row"><div class="col docItemCol_17ae"><div class="docItemContainer_1Jyi"><article><header><h1 class="docTitle_3uYU">内置合约</h1></header><div class="markdown"><p>Conflux 引入了一些内置的内部合约，以便更好地进行系统维护和链上治理。而本文档将介绍如何使用这些内部合约。</p><p>后续文档使用 <a href="https://github.com/Conflux-Chain/js-conflux-sdk" target="_blank" rel="noopener noreferrer">js-conflux-sdk</a> 作为案例</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="通过赞助使用合约的方法"></a>通过赞助使用合约的方法<a aria-hidden="true" tabindex="-1" class="hash-link" href="#通过赞助使用合约的方法" title="Direct link to heading">#</a></h2><p>Conflux 实现了一种赞助机制以补贴用户使用智能合约。因此，一个账户余额为 0 的新用户，只要执行赞助（通常由 Dapps 的运营商赞助），就能够直接调用智能合约。 通过引入内置的 SponsorControl 合约已记录对智能合约的赞助信息。</p><p><strong>SponsorControl</strong> 智能合约为每个用户建立的合约维护以下信息:</p><ul><li><code>sponsor_for_gas</code>: 为提供燃料费用补贴的账户；</li><li><code>sponsor_for_collateral</code>: 为提供存放抵押补贴的账户；</li><li><code>sponsor_balance_for_gas</code>: 可用于燃料费用补贴的余额；</li><li><code>sponsor_balance_for_collateral</code>: 可用于存放抵押补贴的余额；</li><li><code>sponsor_limit_for_gas_fee</code>: 赞助者愿意为每笔交易提供的资助上限；</li><li><code>whitelist</code>: 为合约愿意资助的正常账户清单，特殊的全0地址特指所有的正常账户。只有合约本身才有权更改该清单。</li></ul><p>有两类资源可以被赞助：燃料费用及存储抵押物。</p><ul><li><em>对于燃料费用</em>: 如果一笔交易使用非空的 <code>sponsor_for_gas</code> 调用智能合约且交易发送者处于合约的 <code>whitelist</code> 列表内，且交易指定的燃料费用在 <code>sponsor_limit_for_gas_fee</code> 范围内，交易的燃料消耗将从合约的 <code>sponsor_balance_for_gas</code> 中支付（如果足够的话），而不是由交易发送者的账户余额支付，如果 <code>sponsor_balance_for_gas</code> 无法承担燃料消耗，则交易失败。否则，交易发送者应支付燃料费用。 </li><li><em>对于存储抵押物</em>: 如果一笔交易使用非空的 <code>sponsor_balance_for_collateral</code> 调用智能合约且交易发送者处于合约的 <code>whitelist</code> 列表内，在执行交易的过程中抵押担保物将从智能合约的 <code>sponsor_balance_for_collateral</code> 中扣除，并将这些修改后的存储条目所有者相应设置为合约地址。 否则，交易发送方应在执行过程中支付抵押担保物。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="赞助更新"></a>赞助更新<a aria-hidden="true" tabindex="-1" class="hash-link" href="#赞助更新" title="Direct link to heading">#</a></h3><p>可以通过调用 SponsorControl 合同来更新燃料赞助费用和抵押担保物。要替换合约中的 <code>sponsor_for_gas</code> ，新的赞助人应当向合约转移比当前合约 <code>sponsor_balance_for_gas</code> 更多的资金，并为 <code>sponsor_limit_for_gas_fee</code> 设定一个新值。除非原有的 <code>sponsor_limit_for_gas_fee</code> 无法负担赞助，否则， <code>sponsor_limit_for_gas_fee</code> 的新值应不低于原有赞助者设置的限额。而且，转入的资金应当是新限额的1000倍及以上，这样至少可以补贴 <code>1000</code> 个调用C的交易。 如满足上述条件，则剩余的 <code>sponsor_balance_for_gas</code> 将退还给之前的赞助账户 <code>sponsor_for_gas</code> ，随后根据新赞助商的规范更新 <code>sponsor_balance_for_gas</code> ， <code>sponsor_balance_for_gas</code> ，及 <code>sponsor_limit_for_gas_fee</code> 。</p><p>对 <code>sponsor_for_collateral</code> 的替换操作与上文描述非常类似，只是没有类似于燃料费用的限制。新的赞助人应当向C转入比现有赞助人提供的资金更多的资金作为合约的抵押担保物。那么当前赞助人 <code>sponsor_for_collateral</code> 的担保物将被全额退还，如 <code>sponsor_balance_for_collateral</code> 与合约使用的抵押担保总额之和，此外两个抵押担保字段均按照新赞助人的要求进行相应的变更。一个合约账户允许成为赞助人。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="接口"></a>接口<a aria-hidden="true" tabindex="-1" class="hash-link" href="#接口" title="Direct link to heading">#</a></h3><p>内建的合约地址为 <code>0x8ad036480160591706c831f0da19d1a424e39469</code> 。 内部合约的 abi 可以在 <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/SponsorWhitelistControl.json">这里</a>以及 <a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol">这里</a>获取。</p><ul><li><code>set_sponsor_for_gas(address contract, uint upper_bound)</code> ：如果有人希望向合约地址 <code>contract</code> 赞助燃料费用， 他/她（也可以是合约账户）可以在调用该函数的同时向地址 <code>0x8ad036480160591706c831f0da19d1a424e39469</code> 传输代币。 参数 <code>upper_bound</code> 是指赞助者为单笔交易支付的燃料费用上限。 传输的代币量至少为参数 <code>upper_bound</code> 的1000倍。赞助者可能会被赞助更多代币同时设置更高的上界参数的赞助者所替换。当前赞助者也可以调用该函数并向该合约传输更多代币。在当前赞助者账户余额小于参数 <code>upper_bound</code> 时 ， <code>upper_bound</code> 值将被动态调低。</li><li><code>set_sponsor_for_collateral(address contract_addr)</code>： 如果有人希望向地址为 <code>contract</code> 的合约赞助担保金，他/她（也可以是合约账户）可以在调用该函数的同时向地址 <code>0x8ad036480160591706c831f0da19d1a424e39469</code>传输代币。赞助者可能会被传输更多代币的新赞助者替换而当前赞助者也可通过调用该函数向合约传输更多代币。</li><li><code>add_privilege(address[] memory)</code>:  合约可通过调用该函数向白名单中加入部分正常账户地址。这意味着，若 <code>sponsor_for_gas</code> 被设置，合约会向白名单内的账户支付燃料费用，若 <code>sponsor_for_collateral</code> 被设置，则合约会向白名单内账户支付担保金。合约可通过使用特殊地址 <code>0x0000000000000000000000000000000000000000</code> ，能够将所有账户加入到白名单中。</li><li><code>remove_privilege(address[] memory)</code>：合约可通过调用该函数从白名单中移除正常账户。</li></ul><p>当调用函数时的交易值 <code>set_sponsor_for_gas</code> 及 <code>set_sponsor_for_collateral</code> 代表发送者（新赞助者）愿意支付的代币数量。每个合约通过调用 <code>add_privilege</code> 及 <code>remove_privilege</code> 来维护它的白名单列表 <code>whitelist</code> 。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="样例"></a>样例<a aria-hidden="true" tabindex="-1" class="hash-link" href="#样例" title="Direct link to heading">#</a></h3><p>假设有一个如下所示的简单合约。</p><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-solidity codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity &gt;=0.4.15;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract CommissionPrivilegeTest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mapping(uint =&gt; uint) public ss;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function add(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x8ad036480160591706c831f0DA19D1a424e39469);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.add_privilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function remove(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x8ad036480160591706c831f0DA19D1a424e39469);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.remove_privilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function foo() public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function par_add(uint start, uint end) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for (uint i = start; i &lt; end; i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ss[i] = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>部署合约后，地址为 <code>contract_addr</code> ，如果有人希望赞助燃料费用，他/她可以发送如下交易：</p><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sponsor_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x8ad036480160591706c831f0da19d1a424e39469&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sponsor_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/sponsor.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sponsor_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sponsor_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">set_sponsor_for_gas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_upper_bound</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> your_sponsor_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>至于赞助者的存储抵押物，只需要更换 <code>set_sponsor_for_gas(contract_addr, your_upper_bound)</code> 函数为 <code>set_sponsor_for_collateral(contract_addr)</code> 函数并使用。</p><p>通过使用 <code>add_privilege</code> 和 <code>remove_privilege</code> 为合约维护白名单 <code>whitelist</code> 。含有全0的特殊地址 <code>0x0000000000000000000000000000000000000000</code> 意味着任何人都在 <code>whitelist</code> 内。 需要谨慎的使用它。</p><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>在这一操作后，在调用 <code>you_contract.foo()</code> 或 <code>you_contract.par_add(1, 10)</code> 时存在于 <code>whiltelist</code> 内的账户将不再支付任何费用。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="管理"></a>管理<a aria-hidden="true" tabindex="-1" class="hash-link" href="#管理" title="Direct link to heading">#</a></h2><p>引入 <strong>AdminControl</strong> 合约的目的是为了更好地维护其他智能合约，特别是那些没有适当销毁程序而临时生成的智能合约：它记录了每个用户建立的智能合约的管理员，并根据相应管理员的要求进行销毁处理。</p><p>智能合约的默认管理员是合约的创建者，即使合约创建的交易发送者α。智能合约的当前管理员可通过向 AdminControl 合约发送请求，将其权限转移给另一个普通账户。合约账户不允许成为其他合约的管理者，因为这种机制主要是用于试探性的维护。任何带有自定义授权规则的长期管理都应该在合约内部实现，如作为处理销毁请求的特定功能。</p><p>在任何时候，现有合同的管理人<code>addr</code> 都有权通过调用 AdminControl 申请销毁合约。但是，如果用于存储合同的抵押物不为零，或 <code>addr</code> 不是合约的当前管理者，则该请求将被拒绝。如果 <code>addr</code> 是合约的当前管理者，且合约中的存储抵押品为零，则销毁请求会被接受，且处理流程如下：</p><ol><li>合约余额将退还给 <code>addr</code> ；</li><li>合约中的 <code>sponsor_balance_for_gas</code> 会退还给 <code>sponsor_for_gas</code> ；</li><li>合约中的 <code>sponsor_balance_for_collateral</code> 会退还给 <code>sponsor_for_collateral</code> ；</li><li>合约的内部状态将被解除，并将相应的抵押物退还给拥有者；</li><li>该合约从世界范围内删除。</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="接口-1"></a>接口<a aria-hidden="true" tabindex="-1" class="hash-link" href="#接口-1" title="Direct link to heading">#</a></h3><p>合约地址为 <code>0x8060de9e1568e69811c4a398f92c3d10949dc891</code>。 内部合约的 abi 可以在<a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/AdminControl.json">这里</a>以及<a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/AdminControl.sol">这里</a>获取。</p><ul><li><p><code>set_admin(address contract, address admin)</code>： 设置 <code>admin</code> 为合约 <code>contract</code> 的管理员。函数调用者应为合约 <code>contract</code> 的管理员且账号状态正常。调用者要确保 <code>contract</code> 字段确实写入了合约地址且 <code>admin</code> 字段是正常的账户地址。否则，调用失败。</p></li><li><p><code>destroy(address contract)</code>： 销毁合约 <code>contract</code> 。函数调用者应为合约 <code>contract</code> 的管理员且账号状态正常。 若合约抵押担保非0，则销毁合约失败.否则，合约 <code>contract</code>  的<code>balance</code> 退还给现任管理者处。 <code>sponsor_balance_for_gas</code> 将会退还到 <code>sponsor_for_gas</code> ， <code>sponsor_balance_for_collateral</code> 则会退还到 <code>sponsor_for_collateral</code> 。</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="样例-1"></a>样例<a aria-hidden="true" tabindex="-1" class="hash-link" href="#样例-1" title="Direct link to heading">#</a></h3><p>考虑到您已经部署了一个合约，其地址为 <code>contract_addr</code> 。管理员可以调用 <code>AdminControl.set_admin(contract_addr, new_admin)</code> 以修改管理员，及调用 <code>AdminControl.destroy(contract_addr)</code> 以销毁合约。 </p><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> admin_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x8060de9e1568e69811c4a398f92c3d10949dc891&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> admin_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/admin.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> admin_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 修改管理员</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">set_admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> new_admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 销毁智能合约</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="权益质押机制"></a>权益质押机制<a aria-hidden="true" tabindex="-1" class="hash-link" href="#权益质押机制" title="Direct link to heading">#</a></h2><p>Conflux 引入权益质押机制的原因有两个：一、权益机制提供了一种对占用存储空间更好的收费方式（相比于“一次付费，永久占用”）。二、该机制还有助于定义分散治理中的投票权。</p><p>在高层，Conflux 实现了一个内置的 <strong>Staking</strong> 合约，记录所有账户的权益信息。通过向该合约发送交易，用户（包括外部用户和智能合约）可以存入/提取资金，也被称为合约内的权益。质押资金的利息在提款时发放，其数量取决于提款金额和质押时长。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="利率"></a>利率<a aria-hidden="true" tabindex="-1" class="hash-link" href="#利率" title="Direct link to heading">#</a></h3><p>目前的年化利率为4%。
复利是以区块的颗粒度来实现的。</p><p>执行由账户 <code>addr</code> 在区块 <code>B</code> 发送的交易，并在区块 <code>B&#x27;</code> 提取价值 <code>v</code> 的资金，其利息计算公式如下：</p><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">interest issued = v * (4% / 63072000)^T</span></div></div></div></div></div><p>其中 <code>T = BlockNo(B)−BlockNo(B&#x27;)</code> 是以区块数目衡量的质押时长，而 <code>63072000</code> 是在区块生成时间为 <code>0.5</code> 秒前提下 <code>365</code> 天生成区块数目的期望值。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="质押以获取投票权益"></a>质押以获取投票权益<a aria-hidden="true" tabindex="-1" class="hash-link" href="#质押以获取投票权益" title="Direct link to heading">#</a></h3><p>详细请看<a href="https://confluxnetwork.org/developer/" target="_blank" rel="noopener noreferrer">Conflux Protocol Specification</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="接口-2"></a>接口<a aria-hidden="true" tabindex="-1" class="hash-link" href="#接口-2" title="Direct link to heading">#</a></h3><p>合约地址为 <code>0x843c409373ffd5c0bec1dddb7bec830856757b65</code>。内部合约的abi信息可以在<a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/metadata/Staking.json">这里</a>以及<a href="https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/Staking.sol">这里</a>获取。</p><ul><li><code>deposit(uint amount)</code> ：调用者可以通过调用该函数将部分代币存入Conflux内嵌的权益质押合约。目前的年化利率为4%。</li><li><code>withdraw(uint amount)</code> ： 调用者可通过调用该函数从Conflux内嵌的权益质押合约中提取代币。运行该函数将会触发利息结算。权益质押资金和利息将会按先申请先服务的顺序及时转入到用户账户中。</li><li><code>vote_lock(uint amount, uint unlock_block_number)</code> ：该函数与Conflux的投票权益相关。权益质押用户可以通过选择投票数额及锁定的到期日锁定一定数目的CFX费用。参数 <code>unlock_block_number</code> 会以创世区块产生以来的区块数目度量。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_8LFM" id="样例-2"></a>样例<a aria-hidden="true" tabindex="-1" class="hash-link" href="#样例-2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_3Q1y"><div class="codeBlockContent_1X_u"><button type="button" aria-label="Copy code to clipboard" class="copyButton_tg_z">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_1KQ0"><div class="codeBlockLines_286W" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://testnet-jsonrpc.conflux-chain.org:12537&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGasPrice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> staking_contract_addr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0x843c409373ffd5c0bec1dddb7bec830856757b65&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> staking_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;./contracts/staking.abi.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> staking_contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// deposit some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deposit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// withdraw some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// lock some tokens until some block number</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">vote_lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_unlock_block_number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Conflux-Chain/zh-hans.developer.conflux-chain.org/edit/master/docs/conflux-rust/README.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-06-30T05:29:51.000Z" class="docLastUpdatedAt_2L3z">6/30/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/conflux-doc/independent_chain"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 如何设置独立的conflux区块链</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/conflux-doc/json_rpc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JSON RPC »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3-23"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#通过赞助使用合约的方法" class="table-of-contents__link">通过赞助使用合约的方法</a><ul><li><a href="#赞助更新" class="table-of-contents__link">赞助更新</a></li><li><a href="#接口" class="table-of-contents__link">接口</a></li><li><a href="#样例" class="table-of-contents__link">样例</a></li></ul></li><li><a href="#管理" class="table-of-contents__link">管理</a><ul><li><a href="#接口-1" class="table-of-contents__link">接口</a></li><li><a href="#样例-1" class="table-of-contents__link">样例</a></li></ul></li><li><a href="#权益质押机制" class="table-of-contents__link">权益质押机制</a><ul><li><a href="#利率" class="table-of-contents__link">利率</a></li><li><a href="#质押以获取投票权益" class="table-of-contents__link">质押以获取投票权益</a></li><li><a href="#接口-2" class="table-of-contents__link">接口</a></li><li><a href="#样例-2" class="table-of-contents__link">样例</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">文档</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/conflux_overview">概览</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/conflux-portal/docs/portal/introduction">Portal</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://bounty.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bounty</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">媒体</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Conflux-Chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/Conflux_Network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div>© 2021 Conflux. All Rights Reserved.</div></div></div></footer></div>
<script src="/styles.90a36a4b.js"></script>
<script src="/runtime~main.44580b67.js"></script>
<script src="/main.80992f61.js"></script>
<script src="/1.a6d3011e.js"></script>
<script src="/2.f4b29584.js"></script>
<script src="/19.d2aa76d9.js"></script>
<script src="/25.ab966ef1.js"></script>
<script src="/20ac7829.8e977c11.js"></script>
<script src="/17896441.b7243d10.js"></script>
<script src="/22.472e83af.js"></script>
</body>
</html>